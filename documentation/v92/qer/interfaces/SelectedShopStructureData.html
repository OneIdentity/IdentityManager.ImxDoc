<!doctype html>
<html class="no-js" lang="">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="x-ua-compatible" content="ie=edge">
        <title>IMX Web - QER Library</title>
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">

        <link rel="icon" type="image/x-icon" href="../images/favicon.ico">
	   <link rel="stylesheet" href="../styles/style.css">
        <link rel="stylesheet" href="../styles/dark.css">
        <link rel="stylesheet" href="../styles/material.css">
    </head>
    <body>

        <div class="navbar navbar-default navbar-fixed-top d-block d-sm-none">
            <a href="../" class="navbar-brand">IMX Web - QER Library</a>
            <button type="button" class="btn btn-default btn-menu ion-ios-menu" id="btn-menu"></button>
        </div>

        <div class="xs-menu menu" id="mobile-menu">
                <div id="book-search-input" role="search"><input type="text" placeholder="Type to search"></div>            <compodoc-menu></compodoc-menu>
        </div>

        <div class="container-fluid main">
           <div class="row main">
               <div class="hidden-xs menu">
                   <compodoc-menu mode="normal"></compodoc-menu>
               </div>
               <!-- START CONTENT -->
               <div class="content interface">
                   <div class="content-data">













<ol class="breadcrumb">
  <li class="breadcrumb-item">Interfaces</li>
  <li class="breadcrumb-item"
  >
  SelectedShopStructureData</li>
</ol>

<ul class="nav nav-tabs" role="tablist">
        <li class="nav-item">
            <a href="#info" 
                class="nav-link"
                class="nav-link active"
                role="tab" id="info-tab" data-bs-toggle="tab" data-link="info">Info</a>
        </li>
        <li class="nav-item">
            <a href="#source" 
                class="nav-link"
                
                role="tab" id="source-tab" data-bs-toggle="tab" data-link="source">Source</a>
        </li>
</ul>

<div class="tab-content">
    <div class="tab-pane fade active in" id="info">
        <p class="comment">
            <h3>File</h3>
        </p>
        <p class="comment">
            <code>src/lib/itshop-config/requests.service.ts</code>
        </p>




        <section data-compodoc="block-index">
            <h3 id="index">Index</h3>
            <table class="table table-sm table-bordered index-table">
                <tbody>
                    <tr>
                        <td class="col-md-4">
                            <h6><b>Properties</b></h6>
                        </td>
                    </tr>
                    <tr>
                        <td class="col-md-4">
                            <ul class="index-list">
                                <li>
                                            <span class="modifier">Optional</span>
                                        <a href="#hasMembers" 
>
                                            hasMembers
                                        </a>
                                </li>
                                <li>
                                            <span class="modifier">Optional</span>
                                        <a href="#hasShelves" 
>
                                            hasShelves
                                        </a>
                                </li>
                                <li>
                                            <span class="modifier">Optional</span>
                                        <a href="#selectedShop" 
>
                                            selectedShop
                                        </a>
                                </li>
                            </ul>
                        </td>
                    </tr>
                </tbody>
            </table>
        </section>



            <section data-compodoc="block-properties">
                <h3 id="inputs">Properties</h3>
                    <table class="table table-sm table-bordered">
                        <tbody>
                                <tr>
                                    <td class="col-md-4">
                                        <a name="hasMembers"></a>
                                        <span class="name "><b>hasMembers</b>
                                            <a href="#hasMembers">
                                                <span class="icon ion-ios-link"></span>
                                            </a>
                                        </span>
                                    </td>
                                </tr>
                                <tr>
                                    <td class="col-md-4">
                                        <code>hasMembers:         <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/boolean" target="_blank" >boolean</a></code>
</code>
                                    </td>
                                </tr>


                                    <tr>
                                        <td class="col-md-4">
                                            <i>Type : </i>        <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/boolean" target="_blank" >boolean</a></code>

                                        </td>
                                    </tr>

                                    <tr>
                                        <td class="col-md-4">
                                            <i>Optional</i>
                                        </td>
                                    </tr>




                        </tbody>
                    </table>
                    <table class="table table-sm table-bordered">
                        <tbody>
                                <tr>
                                    <td class="col-md-4">
                                        <a name="hasShelves"></a>
                                        <span class="name "><b>hasShelves</b>
                                            <a href="#hasShelves">
                                                <span class="icon ion-ios-link"></span>
                                            </a>
                                        </span>
                                    </td>
                                </tr>
                                <tr>
                                    <td class="col-md-4">
                                        <code>hasShelves:         <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/boolean" target="_blank" >boolean</a></code>
</code>
                                    </td>
                                </tr>


                                    <tr>
                                        <td class="col-md-4">
                                            <i>Type : </i>        <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/boolean" target="_blank" >boolean</a></code>

                                        </td>
                                    </tr>

                                    <tr>
                                        <td class="col-md-4">
                                            <i>Optional</i>
                                        </td>
                                    </tr>




                        </tbody>
                    </table>
                    <table class="table table-sm table-bordered">
                        <tbody>
                                <tr>
                                    <td class="col-md-4">
                                        <a name="selectedShop"></a>
                                        <span class="name "><b>selectedShop</b>
                                            <a href="#selectedShop">
                                                <span class="icon ion-ios-link"></span>
                                            </a>
                                        </span>
                                    </td>
                                </tr>
                                <tr>
                                    <td class="col-md-4">
                                        <code>selectedShop:     <code>PortalShopConfigStructure</code>
</code>
                                    </td>
                                </tr>


                                    <tr>
                                        <td class="col-md-4">
                                            <i>Type : </i>    <code>PortalShopConfigStructure</code>

                                        </td>
                                    </tr>

                                    <tr>
                                        <td class="col-md-4">
                                            <i>Optional</i>
                                        </td>
                                    </tr>




                        </tbody>
                    </table>
            </section>
    </div>


    <div class="tab-pane fade  tab-source-code" id="source">
        <pre class="line-numbers compodoc-sourcecode"><code class="language-typescript">import { OverlayRef } from &#x27;@angular/cdk/overlay&#x27;;
import { Injectable } from &#x27;@angular/core&#x27;;
import { EuiLoadingService } from &#x27;@elemental-ui/core&#x27;;
import { TranslateService } from &#x27;@ngx-translate/core&#x27;;

import { PortalRolesExclusions, PortalShopConfigMembers, PortalShopConfigStructure } from &#x27;imx-api-qer&#x27;;
import {
  CollectionLoadParameters,
  CompareOperator,
  EntityCollectionData,
  EntitySchema,
  FilterType,
  TypedEntityCollectionData,
} from &#x27;imx-qbm-dbts&#x27;;
import { ClassloggerService, SnackBarService } from &#x27;qbm&#x27;;
import { QerApiService } from &#x27;../qer-api-client.service&#x27;;
import { IRequestableEntitlementType } from &#x27;./irequestable-entitlement-type&#x27;;

export const ACTION_DISMISS &#x3D; &#x27;#LDS#Close&#x27;;

export interface SelectedShopStructureData {
  selectedShop?: PortalShopConfigStructure;
  hasMembers?: boolean;
  hasShelves?: boolean;
}

@Injectable({
  providedIn: &#x27;root&#x27;,
})
export class RequestsService {
  public shelvesBlockedDeleteStatus: { [shelfId: string]: boolean } &#x3D; {};
  private busyIndicator: OverlayRef;

  constructor(
    private readonly qerApiClient: QerApiService,
    private readonly logger: ClassloggerService,
    private readonly snackbar: SnackBarService,
    private readonly translate: TranslateService,
    private readonly busyService: EuiLoadingService
  ) {}

  public selectedEntitlementType: IRequestableEntitlementType;

  public get shopStructureSchema(): EntitySchema {
    return this.qerApiClient.typedClient.PortalShopConfigStructure.GetSchema();
  }

  public get shopConfigMembersSchema(): EntitySchema {
    return this.qerApiClient.typedClient.PortalShopConfigMembers.GetSchema();
  }

  public get shopConfigExcludedMembersSchema(): EntitySchema {
    return this.qerApiClient.typedClient.PortalRolesExclusions.GetSchema();
  }

  public async getShopStructures(
    navigationState: CollectionLoadParameters,
    parentId: string &#x3D; &#x27;&#x27;
  ): Promise&lt;TypedEntityCollectionData&lt;PortalShopConfigStructure&gt;&gt; {
    let params: any &#x3D; navigationState;
    if (!params) {
      params &#x3D; {};
    }
    if (parentId &#x3D;&#x3D; &#x27;&#x27;) {
      params.filter &#x3D; [
        {
          ColumnName: &#x27;ITShopInfo&#x27;,
          CompareOp: CompareOperator.Equal,
          Type: FilterType.Compare,
          Value1: &#x27;SH&#x27;,
        },
      ];
    }
    params.ParentKey &#x3D; parentId;
    this.logger.debug(this, &#x60;Retrieving shop config structures&#x60;);
    this.logger.trace(&#x27;Navigation state&#x27;, navigationState);
    return this.qerApiClient.typedClient.PortalShopConfigStructure.Get(params);
  }

  public createRequestConfigEntity(): PortalShopConfigStructure {
    return this.qerApiClient.typedClient.PortalShopConfigStructure.createEntity();
  }

  public createNewRequestConfig(newRequest: PortalShopConfigStructure): Promise&lt;TypedEntityCollectionData&lt;PortalShopConfigStructure&gt;&gt; {
    return this.qerApiClient.typedClient.PortalShopConfigStructure.Post(newRequest);
  }

  public deleteRequestConfiguration(id: string): Promise&lt;EntityCollectionData&gt; {
    return this.qerApiClient.client.portal_shop_config_structure_delete(id);
  }

  public getRequestConfigMembers(
    customerNodeId: string,
    navigationState: CollectionLoadParameters
  ): Promise&lt;TypedEntityCollectionData&lt;PortalShopConfigMembers&gt;&gt; {
    return this.qerApiClient.typedClient.PortalShopConfigMembers.Get(customerNodeId, navigationState);
  }

  public generateRequestConfigMemberEntity(customerNodeId: string): PortalShopConfigMembers {
    return this.qerApiClient.typedClient.PortalShopConfigMembers.createEntity({
      Columns: {
        UID_ITShopOrg: {
          Value: customerNodeId,
        },
      },
    });
  }

  public createRequestConfigMember(
    customerNodeId: string,
    newMember: PortalShopConfigMembers
  ): Promise&lt;TypedEntityCollectionData&lt;PortalShopConfigMembers&gt;&gt; {
    return this.qerApiClient.typedClient.PortalShopConfigMembers.Post(customerNodeId, newMember);
  }

  public addMultipleRequestConfigMembers(values: string[], customerNodeId: string): Promise&lt;any&gt; {
    const promises &#x3D; [];
    values.forEach((value) &#x3D;&gt; {
      const entity &#x3D; this.qerApiClient.typedClient.PortalShopConfigMembers.createEntity();
      entity.UID_Person.value &#x3D; value;
      promises.push(this.createRequestConfigMember(customerNodeId, entity));
    });
    return Promise.all(promises);
  }

  public removeRequestConfigMembers(
    customerNodeId: string,
    uidDynamicGroup: string,
    members: PortalShopConfigMembers[],
    description?: string
  ): Promise&lt;any&gt; {
    const promises &#x3D; [];
    members.forEach((member) &#x3D;&gt; {
      // If the member is managed by a dynamic group, add an exclusion
      // tslint:disable-next-line:no-bitwise
      if ((member.XOrigin?.value &amp; 4) &gt; 0) {
        const exclusionData &#x3D; this.qerApiClient.typedClient.PortalRolesExclusions.createEntity();
        exclusionData.UID_Person.value &#x3D; member.UID_Person.value;
        exclusionData.Description.value &#x3D; description || &#x27;&#x27;;
        promises.push(this.addDynamicRoleExclusion(uidDynamicGroup, exclusionData));
      } else {
        // Otherwise just a regular delete
        promises.push(this.qerApiClient.client.portal_shop_config_members_delete(customerNodeId, member.UID_Person.value));
      }
    });
    return Promise.all(promises);
  }

  public removeRequestConfigMemberExclusions(uidDynamicGroup: string, exclusions: PortalRolesExclusions[]): Promise&lt;any&gt; {
    const promises &#x3D; [];
    exclusions.forEach((exclusion) &#x3D;&gt; {
      const memberUid &#x3D; exclusion.UID_Person?.value;
      promises.push(this.removeDynamicRoleExclusion(uidDynamicGroup, memberUid));
    });
    return Promise.all(promises);
  }

  public getExcludedRequestConfigMembers(uidDynamicGroup: string, navigationState: CollectionLoadParameters): Promise&lt;any&gt; {
    return this.qerApiClient.typedClient.PortalRolesExclusions.Get(uidDynamicGroup, navigationState);
  }

  public async addDynamicRoleExclusion(uidDynamicGroup: string, exclusionData: PortalRolesExclusions): Promise&lt;any&gt; {
    this.qerApiClient.typedClient.PortalRolesExclusions.Post(uidDynamicGroup, exclusionData);
  }

  public async removeDynamicRoleExclusion(uidDynamicGroup: string, uidPerson: string): Promise&lt;any&gt; {
    this.qerApiClient.client.portal_roles_exclusions_delete(uidDynamicGroup, uidPerson);
  }

  /**
   * Tracks a timeout of 1.5 minutes where the given shelf is blocked from being deleted
   * to allow enough time for the API to process the removal of system entitlements from the shelf
   */
  public manageShelfDeleteStatus(shelfId: string): void {
    this.shelvesBlockedDeleteStatus[shelfId] &#x3D; true;
    setTimeout(() &#x3D;&gt; {
      this.shelvesBlockedDeleteStatus[shelfId] &#x3D; false;
    }, 90000);
  }

  public openSnackbar(message: string, action: string): void {
    this.snackbar.open({ key: message }, action);
  }

  public handleOpenLoader(): void {
    if (!this.busyIndicator) {
      this.busyIndicator &#x3D; this.busyService.show();
    }
  }

  public handleCloseLoader(): void {
    if (this.busyIndicator) {
      setTimeout(() &#x3D;&gt; {
        this.busyService.hide(this.busyIndicator);
        this.busyIndicator &#x3D; undefined;
      });
    }
  }

  public LdsSpecifyMembers &#x3D; &#x27;#LDS#Here you can specify who can request the products assigned to the shop.&#x27;;

  public LdsMembersByDynamicRole &#x3D;
    &#x27;#LDS#Here you can see the members that are originally assigned to the shop by a dynamic role but have been excluded. Additionally, you can add these excluded members back to the shop by removing the exclusion.&#x27;;

  public LdsMembersRemoved &#x3D;
    &#x27;#LDS#The members have been successfully removed from the shop. It may take some time for the changes to take effect.&#x27;;

  public LdsMembersAdded &#x3D;
    &#x27;#LDS#The members have been successfully added to the shop. It may take some time for the changes to take effect.&#x27;;

  public LdsMembersUpdated &#x3D; &#x27;#LDS#The shop members have been successfully updated.&#x27;;

  public LdsDeleteShop &#x3D; &#x27;#LDS#Delete shop&#x27;;

  public LdsShopHasBeenDeleted &#x3D; &#x27;#LDS#The shop has been successfully deleted.&#x27;;

  public LdsShopHasBeenCreated &#x3D; &#x27;#LDS#The shop has been successfully created.&#x27;;

  public LdsShopHasBeenSaved &#x3D; &#x27;#LDS#The shop has been successfully saved.&#x27;;

  public LdsNoShops &#x3D; &#x27;#LDS#There are currently no shops.&#x27;;

  public LdsNoMatchingShops &#x3D; &#x27;#LDS#There are no shops matching your search.&#x27;;

  public LdsHeadingCreateShop &#x3D; &#x27;#LDS#Heading Create Shop&#x27;;

  public LdsHeadingEditShop &#x3D; &#x27;#LDS#Heading Edit Shop&#x27;;

  public LdsHeadingShops &#x3D; &#x27;#LDS#Heading Shops&#x27;;

  public LdsShopExplanation &#x3D;
    &#x27;#LDS#A shop is the top element in the hierarchical structure required for requesting products. Here you can setup and manage shops. For each shop you can specify which products can be requested (through shelves) and who can request them.&#x27;;

  public LdsCreateShop &#x3D; &#x27;#LDS#Create shop&#x27;;
}
</code></pre>
    </div>
</div>








                   </div><div class="search-results">
    <div class="has-results">
        <h1 class="search-results-title"><span class='search-results-count'></span> results matching "<span class='search-query'></span>"</h1>
        <ul class="search-results-list"></ul>
    </div>
    <div class="no-results">
        <h1 class="search-results-title">No results matching "<span class='search-query'></span>"</h1>
    </div>
</div>
</div>
               <!-- END CONTENT -->
           </div>
       </div>

          <label class="dark-mode-switch">
               <input type="checkbox">
               <span class="slider">
                    <svg class="slider-icon" viewBox="0 0 24 24" fill="none" height="20" stroke="#000" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" width="20" xmlns="http://www.w3.org/2000/svg">
                    <path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"></path>
                    </svg>
               </span>
          </label>

       <script>
            var COMPODOC_CURRENT_PAGE_DEPTH = 1;
            var COMPODOC_CURRENT_PAGE_CONTEXT = 'interface';
            var COMPODOC_CURRENT_PAGE_URL = 'SelectedShopStructureData.html';
            var MAX_SEARCH_RESULTS = 15;
       </script>

       <script src="../js/libs/custom-elements.min.js"></script>
       <script src="../js/libs/lit-html.js"></script>

       <script src="../js/menu-wc.js" defer></script>
       <script nomodule src="../js/menu-wc_es5.js" defer></script>

       <script src="../js/libs/bootstrap-native.js"></script>

       <script src="../js/libs/es6-shim.min.js"></script>
       <script src="../js/libs/EventDispatcher.js"></script>
       <script src="../js/libs/promise.min.js"></script>
       <script src="../js/libs/zepto.min.js"></script>

       <script src="../js/compodoc.js"></script>

       <script src="../js/tabs.js"></script>
       <script src="../js/menu.js"></script>
       <script src="../js/libs/clipboard.min.js"></script>
       <script src="../js/libs/prism.js"></script>
       <script src="../js/sourceCode.js"></script>
          <script src="../js/search/search.js"></script>
          <script src="../js/search/lunr.min.js"></script>
          <script src="../js/search/search-lunr.js"></script>
          <script src="../js/search/search_index.js"></script>
       <script src="../js/lazy-load-graphs.js"></script>


    </body>
</html>
